#N canvas 87 22 1052 708 10;
#X obj 39 89 inlet~;
#X obj 151 462 outlet~;
#X obj 796 423 r \$0-blocksize;
#X obj 796 445 list prepend \$0;
#X msg 796 467 \; \$1-real resize \$2 \; \$1-imag resize \$2 \; \$1-processed-real
resize \$2 \; \$1-processed-imag resize \$2;
#X obj 796 207 s \$0-blocksize;
#X text 793 400 --- resize arrays to block size ---;
#X obj 796 89 inlet;
#X obj 857 181 s \$0-transpose;
#X obj 897 161 s \$0-mirrornote;
#X obj 167 238 r \$0-state;
#N canvas 0 22 770 673 spectral_mirror 0;
#X obj 167 462 *~;
#X obj 182 437 tabreceive~ \$0-hann;
#N canvas 0 22 642 364 fft 0;
#X obj 137 45 inlet~;
#X obj 137 283 outlet~;
#X obj 137 147 rfft~;
#X obj 137 199 tabsend~ \$0-real;
#X obj 164 177 tabsend~ \$0-imag;
#X text 136 261 outlet for dsp execution order forcing;
#X text 276 190 write one block continuously;
#X connect 0 0 2 0;
#X connect 2 0 3 0;
#X connect 2 1 4 0;
#X restore 167 255 pd fft;
#N canvas 0 22 864 489 ifft 0;
#X obj 137 45 inlet~;
#X obj 137 420 outlet~;
#X obj 137 341 rifft~;
#X obj 137 291 /~ 768;
#X obj 200 291 /~ 768;
#X text 138 66 inlet for dsp execution order forcing;
#X text 198 147 read one block continuously;
#X obj 419 169 r \$0-blocksize;
#X obj 419 201 * 3;
#X obj 419 223 / 2;
#X text 451 212 3/2: normalization for Hann window and overlap-4;
#X text 514 169 N;
#X text 327 272 divide by 3N/2 for normalisation;
#X obj 137 169 tabreceive~ \$0-processed-real;
#X obj 200 197 tabreceive~ \$0-processed-imag;
#X connect 2 0 1 0;
#X connect 3 0 2 0;
#X connect 4 0 2 1;
#X connect 7 0 8 0;
#X connect 8 0 9 0;
#X connect 9 0 4 1;
#X connect 9 0 3 1;
#X connect 13 0 3 0;
#X connect 14 0 4 0;
#X restore 167 385 pd ifft;
#X obj 167 208 *~;
#X obj 182 184 tabreceive~ \$0-hann;
#N canvas 15 24 968 715 processing 0;
#X obj 104 299 outlet~;
#X obj 418 94 bang~;
#X obj 418 278 until;
#X obj 418 310 f;
#X msg 468 278 0;
#X obj 468 310 + 1;
#X obj 108 173 inlet~;
#X obj 418 564 tabread \$0-real;
#X obj 598 564 tabread \$0-imag;
#N canvas 575 34 446 696 calc 0;
#X obj 127 30 inlet;
#X obj 154 644 outlet;
#X obj 154 266 + 0;
#X obj 193 101 samplerate~;
#X obj 154 125 * 44100;
#X obj 154 177 / 512;
#X obj 181 154 r \$0-blocksize;
#X obj 193 550 samplerate~;
#X obj 181 476 r \$0-blocksize;
#X obj 154 75 t f b;
#X obj 154 574 / 44100;
#X obj 154 499 * 512;
#X obj 154 524 t f b;
#X obj 154 214 ftom;
#X obj 154 440 mtof;
#X obj 127 52 sel 0;
#X obj 154 596 + 0.5;
#X obj 154 618 int;
#X obj 169 394 * 2;
#X obj 169 372 r \$0-mirrornote;
#X obj 169 242 r \$0-transpose;
#X obj 154 295 * -1;
#X obj 154 417 +;
#X connect 0 0 15 0;
#X connect 2 0 21 0;
#X connect 3 0 4 1;
#X connect 4 0 5 0;
#X connect 5 0 13 0;
#X connect 6 0 5 1;
#X connect 7 0 10 1;
#X connect 8 0 11 1;
#X connect 9 0 4 0;
#X connect 9 1 3 0;
#X connect 10 0 16 0;
#X connect 11 0 12 0;
#X connect 12 0 10 0;
#X connect 12 1 7 0;
#X connect 13 0 2 0;
#X connect 14 0 11 0;
#X connect 15 1 9 0;
#X connect 16 0 17 0;
#X connect 17 0 1 0;
#X connect 18 0 22 1;
#X connect 19 0 18 0;
#X connect 20 0 2 1;
#X connect 21 0 22 0;
#X connect 22 0 14 0;
#X restore 612 395 pd calc;
#X text 335 253 block size N;
#X text 459 94 bang each block;
#X text 508 299 count from '0' to 'N-1' in each block;
#X obj 418 596 tabwrite \$0-processed-real;
#X obj 598 596 tabwrite \$0-processed-imag;
#X obj 418 251 f 512;
#X obj 604 98 r \$0-blocksize;
#X obj 418 126 t b b b;
#X obj 605 183 float \$0;
#X msg 605 205 \; \$1-processed-real const 0 \; \$1-processed-imag
const 0;
#X text 86 216 inlet & outlet;
#X text 26 236 for dsp execution order forcing;
#X text 198 597 write single bins to output buffer;
#X text 199 563 read single bins from input buffer;
#X text 603 160 set whole output buffer to zero;
#X obj 418 520 spigot;
#X obj 598 520 spigot;
#X obj 612 420 t f f f;
#X obj 631 449 > 0;
#X obj 661 449 < 256;
#X obj 631 475 &&;
#X obj 418 342 t f f;
#X obj 688 395 r \$0-blocksize;
#X obj 688 420 / 2;
#X text 610 369 calculations for bin indices;
#X connect 1 0 17 0;
#X connect 2 0 3 0;
#X connect 3 0 5 0;
#X connect 3 0 31 0;
#X connect 4 0 3 1;
#X connect 5 0 3 1;
#X connect 7 0 13 0;
#X connect 8 0 14 0;
#X connect 9 0 27 0;
#X connect 15 0 2 0;
#X connect 16 0 15 1;
#X connect 17 0 15 0;
#X connect 17 1 4 0;
#X connect 17 2 18 0;
#X connect 18 0 19 0;
#X connect 25 0 7 0;
#X connect 26 0 8 0;
#X connect 27 0 13 1;
#X connect 27 0 14 1;
#X connect 27 1 28 0;
#X connect 27 2 29 0;
#X connect 28 0 30 0;
#X connect 29 0 30 1;
#X connect 30 0 26 1;
#X connect 30 0 25 1;
#X connect 31 0 25 0;
#X connect 31 0 26 0;
#X connect 31 1 9 0;
#X connect 32 0 33 0;
#X connect 33 0 29 1;
#X restore 167 316 pd processing;
#X text 203 207 multiply by window;
#X text 200 462 multiply by window;
#X text 217 256 write block to input-buffer;
#X text 256 318 - read input buffer;
#X text 222 386 read block from output-buffer;
#X text 256 333 - process;
#X text 256 348 - write to output-buffer;
#X obj 167 127 inlet~;
#X obj 167 616 outlet~;
#X obj 499 235 table \$0-real 512;
#X obj 499 255 table \$0-imag 512;
#X obj 499 356 table \$0-processed-real 512;
#X obj 499 376 table \$0-processed-imag 512;
#X text 496 212 input buffer (size = 1 block);
#X text 496 334 output buffer (size = 1 block);
#X obj 251 565 switch~;
#X obj 167 585 *~;
#X obj 182 538 pack 0 5;
#X obj 182 560 line~;
#X obj 182 510 t f f;
#X obj 251 538 1del0 15;
#X obj 182 486 r \$0-state;
#X connect 0 0 23 0;
#X connect 1 0 0 1;
#X connect 2 0 6 0;
#X connect 3 0 0 0;
#X connect 4 0 2 0;
#X connect 5 0 4 1;
#X connect 6 0 3 0;
#X connect 14 0 4 0;
#X connect 23 0 15 0;
#X connect 24 0 25 0;
#X connect 25 0 23 1;
#X connect 26 0 24 0;
#X connect 26 1 27 0;
#X connect 27 0 22 0;
#X connect 28 0 26 0;
#X restore 151 398 pd spectral_mirror;
#X obj 576 364 block~ 512 4 1;
#X msg 576 340 set \$1 4 1;
#X obj 576 316 r \$0-blocksize;
#X text 586 99 create Hann-window at startup;
#N canvas 559 123 637 509 hann-window 0;
#N canvas 0 22 450 300 (subpatch) 0;
#X array \$0-hann 512 float 0;
#X coords 0 1 511 0 200 120 1;
#X restore 403 213 graph;
#X msg 181 333 0;
#X obj 75 382 osc~;
#X obj 75 334 samplerate~;
#X obj 75 415 *~ -0.5;
#X obj 75 438 +~ 0.5;
#X obj 57 473 tabwrite~ \$0-hann;
#X text 389 205 1;
#X text 382 323 0;
#X text 398 336 0;
#X obj 57 263 bng 15 250 50 0 empty empty empty 0 -6 0 8 -262144 -1
-1;
#X text 446 185 Hann window;
#X msg 79 199 \; pd dsp 1;
#X obj 192 87 r \$0-blocksize;
#X text 223 190 overlap-4;
#X obj 192 211 t b f;
#X obj 192 189 / 4;
#X obj 192 109 t f f;
#X obj 219 154 s \$0-hann;
#X msg 219 131 resize \$1;
#X text 290 131 resize window to new block size;
#X text 116 384 oscillator with period = 1 block;
#X text 286 87 N;
#X text 594 339 N-1;
#X text 132 416 invert & scale;
#X text 123 439 offset;
#X text 211 333 reset phase;
#X text 171 474 write 1 block to table;
#X text 245 285 RECALCULATE;
#X obj 57 146 loadbang;
#X obj 75 358 / 128;
#X obj 57 168 t b b;
#X obj 57 289 t b b b;
#X connect 1 0 2 1;
#X connect 2 0 4 0;
#X connect 3 0 30 0;
#X connect 4 0 5 0;
#X connect 5 0 6 0;
#X connect 10 0 32 0;
#X connect 13 0 17 0;
#X connect 15 0 10 0;
#X connect 15 1 30 1;
#X connect 16 0 15 0;
#X connect 17 0 16 0;
#X connect 17 1 19 0;
#X connect 19 0 18 0;
#X connect 29 0 31 0;
#X connect 30 0 2 0;
#X connect 31 0 10 0;
#X connect 31 1 12 0;
#X connect 32 0 6 0;
#X connect 32 1 3 0;
#X connect 32 2 1 0;
#X restore 588 123 pd hann-window;
#X text 573 294 --- set block size ---;
#X obj 167 260 == 0;
#X obj 39 394 fx_gain~;
#X text 370 561 (c)2012 Marian Weger;
#X text 40 33 fx_spectralmirror~;
#X obj 796 114 route blocksize transpose mirrornote state;
#X obj 937 141 s \$0-state;
#X connect 0 0 11 0;
#X connect 0 0 19 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 7 0 22 0;
#X connect 10 0 18 0;
#X connect 11 0 1 0;
#X connect 13 0 12 0;
#X connect 14 0 13 0;
#X connect 18 0 19 1;
#X connect 19 0 1 0;
#X connect 22 0 5 0;
#X connect 22 1 8 0;
#X connect 22 2 9 0;
#X connect 22 3 23 0;
